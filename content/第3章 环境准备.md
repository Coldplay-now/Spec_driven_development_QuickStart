# 第3章 环境准备

在开始SDD（Spec-Driven Development）实践之前，我们需要搭建一个完整的开发环境。本章将指导你完成从Trae AI IDE安装到各种开发工具配置的全过程。

## 3.1 Trae AI IDE安装与配置

### 3.1.1 系统要求

**最低系统要求：**
- 操作系统：Windows 10/11、macOS 10.15+、Linux (Ubuntu 18.04+)
- 内存：8GB RAM（推荐16GB+）
- 存储：至少5GB可用空间
- 网络：稳定的互联网连接

**推荐配置：**
- CPU：Intel i5/AMD Ryzen 5 或更高
- 内存：16GB+ RAM
- 存储：SSD硬盘
- 显卡：支持硬件加速的独立显卡（可选）

### 3.1.2 下载与安装

**步骤1：访问官网**
1. 打开浏览器，访问 [Trae AI官网](https://trae.ai)
2. 点击"Download"按钮
3. 选择适合你操作系统的版本

**步骤2：安装程序**

**Windows用户：**
```bash
# 下载安装包后，双击运行
# 按照安装向导完成安装
# 默认安装路径：C:\Program Files\Trae AI
```

**macOS用户：**
```bash
# 方法1：直接下载dmg文件安装
# 方法2：使用Homebrew安装
brew install --cask trae-ai
```

**Linux用户：**
```bash
# Ubuntu/Debian
wget https://releases.trae.ai/linux/trae-ai_latest.deb
sudo dpkg -i trae-ai_latest.deb

# CentOS/RHEL
wget https://releases.trae.ai/linux/trae-ai_latest.rpm
sudo rpm -i trae-ai_latest.rpm

# 通用AppImage
wget https://releases.trae.ai/linux/trae-ai_latest.AppImage
chmod +x trae-ai_latest.AppImage
./trae-ai_latest.AppImage
```

### 3.1.3 首次启动配置

**步骤1：账户设置**
1. 启动Trae AI IDE
2. 选择"Create Account"或"Sign In"
3. 完成邮箱验证
4. 设置用户名和密码

**步骤2：基础配置**
```json
{
  "theme": "dark",
  "fontSize": 14,
  "tabSize": 2,
  "autoSave": true,
  "aiAssistant": {
    "enabled": true,
    "model": "gpt-4",
    "autoComplete": true
  }
}
```

**步骤3：插件安装**
必备插件列表：
- **SDD Assistant**: SDD开发流程支持
- **Spec Generator**: 自动生成规范文档
- **Code Reviewer**: AI代码审查
- **Test Generator**: 自动测试生成

## 3.2 Python开发环境搭建

### 3.2.1 Python版本管理

**安装pyenv（推荐）：**

**macOS/Linux：**
```bash
# 安装pyenv
curl https://pyenv.run | bash

# 添加到shell配置文件
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc

# 重新加载配置
source ~/.bashrc
```

**Windows：**
```powershell
# 使用pyenv-win
git clone https://github.com/pyenv-win/pyenv-win.git %USERPROFILE%\.pyenv

# 添加环境变量
# PYENV = %USERPROFILE%\.pyenv\pyenv-win
# PATH += %USERPROFILE%\.pyenv\pyenv-win\bin;%USERPROFILE%\.pyenv\pyenv-win\shims
```

### 3.2.2 Python 3.8+安装

```bash
# 查看可用版本
pyenv install --list | grep 3.8

# 安装Python 3.8.18（推荐）
pyenv install 3.8.18

# 设置全局版本
pyenv global 3.8.18

# 验证安装
python --version
# 输出：Python 3.8.18
```

### 3.2.3 虚拟环境配置

```bash
# 创建项目虚拟环境
python -m venv sdd_env

# 激活虚拟环境
# Windows
sdd_env\Scripts\activate
# macOS/Linux
source sdd_env/bin/activate

# 升级pip
pip install --upgrade pip

# 安装基础包
pip install requests pytest black flake8 mypy
```

### 3.2.4 必备Python包安装

创建`requirements.txt`文件：
```txt
# 核心开发包
requests>=2.28.0
click>=8.0.0
rich>=12.0.0
pydantic>=1.10.0

# 测试工具
pytest>=7.0.0
pytest-cov>=4.0.0
pytest-mock>=3.8.0

# 代码质量
black>=22.0.0
flake8>=5.0.0
mypy>=0.991
isort>=5.10.0

# 文档生成
sphinx>=5.0.0
mkdocs>=1.4.0

# AI/ML相关（可选）
openai>=0.27.0
langchain>=0.0.200
```

安装依赖：
```bash
pip install -r requirements.txt
```

## 3.3 TypeScript开发环境配置

### 3.3.1 Node.js安装

**使用nvm管理Node.js版本：**

**macOS/Linux：**
```bash
# 安装nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 重新加载终端
source ~/.bashrc

# 安装Node.js LTS版本
nvm install --lts
nvm use --lts

# 验证安装
node --version
npm --version
```

**Windows：**
```powershell
# 下载并安装nvm-windows
# https://github.com/coreybutler/nvm-windows/releases

# 安装Node.js
nvm install lts
nvm use lts
```

### 3.3.2 TypeScript全局安装

```bash
# 安装TypeScript编译器
npm install -g typescript

# 安装ts-node（用于直接运行TypeScript）
npm install -g ts-node

# 验证安装
tsc --version
ts-node --version
```

### 3.3.3 项目初始化

```bash
# 创建新项目
mkdir my-sdd-project
cd my-sdd-project

# 初始化npm项目
npm init -y

# 初始化TypeScript配置
tsc --init
```

**推荐的tsconfig.json配置：**
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

## 3.4 Tailwind CSS集成设置

### 3.4.1 安装Tailwind CSS

```bash
# 安装Tailwind CSS及其依赖
npm install -D tailwindcss postcss autoprefixer

# 生成配置文件
npx tailwindcss init -p
```

### 3.4.2 配置文件设置

**tailwind.config.js：**
```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./src/**/*.{html,js,ts,jsx,tsx}",
    "./public/**/*.html"
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          500: '#3b82f6',
          900: '#1e3a8a',
        }
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
        mono: ['Fira Code', 'monospace'],
      }
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography'),
  ],
}
```

### 3.4.3 CSS文件配置

创建`src/styles/globals.css`：
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    font-family: 'Inter', sans-serif;
  }
  
  code {
    font-family: 'Fira Code', monospace;
  }
}

@layer components {
  .btn-primary {
    @apply bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-lg transition-colors;
  }
  
  .card {
    @apply bg-white shadow-lg rounded-lg p-6 border border-gray-200;
  }
}
```

## 3.5 DeepSeek API密钥配置

### 3.5.1 获取API密钥

1. 访问 [DeepSeek官网](https://platform.deepseek.com)
2. 注册账户并完成验证
3. 进入API管理页面
4. 创建新的API密钥
5. 复制并安全保存密钥

### 3.5.2 环境变量配置

**创建.env文件：**
```bash
# DeepSeek API配置
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_BASE_URL=https://api.deepseek.com

# 其他API配置
OPENAI_API_KEY=your_openai_key_here
ANTHROPIC_API_KEY=your_anthropic_key_here

# 开发环境配置
DEBUG=true
LOG_LEVEL=info
```

**Python环境变量加载：**
```python
# 安装python-dotenv
pip install python-dotenv

# 在代码中使用
from dotenv import load_dotenv
import os

load_dotenv()

api_key = os.getenv('DEEPSEEK_API_KEY')
base_url = os.getenv('DEEPSEEK_BASE_URL')
```

**Node.js环境变量加载：**
```bash
# 安装dotenv
npm install dotenv
```

```typescript
// 在代码中使用
import dotenv from 'dotenv';
dotenv.config();

const apiKey = process.env.DEEPSEEK_API_KEY;
const baseUrl = process.env.DEEPSEEK_BASE_URL;
```

### 3.5.3 API测试

**Python测试脚本：**
```python
import requests
import os
from dotenv import load_dotenv

load_dotenv()

def test_deepseek_api():
    api_key = os.getenv('DEEPSEEK_API_KEY')
    base_url = os.getenv('DEEPSEEK_BASE_URL')
    
    headers = {
        'Authorization': f'Bearer {api_key}',
        'Content-Type': 'application/json'
    }
    
    data = {
        'model': 'deepseek-chat',
        'messages': [
            {'role': 'user', 'content': 'Hello, DeepSeek!'}
        ],
        'max_tokens': 100
    }
    
    response = requests.post(
        f'{base_url}/v1/chat/completions',
        headers=headers,
        json=data
    )
    
    if response.status_code == 200:
        print("✅ DeepSeek API连接成功！")
        print(response.json())
    else:
        print(f"❌ API连接失败：{response.status_code}")
        print(response.text)

if __name__ == '__main__':
    test_deepseek_api()
```

## 3.6 必备工具和插件安装

### 3.6.1 Git配置

```bash
# 设置用户信息
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 设置默认编辑器
git config --global core.editor "code --wait"

# 设置默认分支名
git config --global init.defaultBranch main

# 启用颜色输出
git config --global color.ui auto
```

### 3.6.2 VS Code插件（如果使用VS Code作为备用编辑器）

推荐插件列表：
```json
{
  "recommendations": [
    "ms-python.python",
    "ms-python.black-formatter",
    "ms-python.flake8",
    "ms-python.mypy-type-checker",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-typescript-next",
    "github.copilot",
    "ms-vscode.test-adapter-converter",
    "ms-vscode.live-server"
  ]
}
```

### 3.6.3 命令行工具

**必备CLI工具：**
```bash
# 安装常用CLI工具
npm install -g @angular/cli create-react-app vue-cli
npm install -g prettier eslint typescript
npm install -g http-server live-server

# Python工具
pip install cookiecutter pre-commit

# 系统工具（macOS）
brew install tree jq curl wget

# 系统工具（Linux）
sudo apt-get install tree jq curl wget
```

## 3.7 SDD工作流程配置

### 3.7.1 项目模板创建

创建SDD项目模板结构：
```
sdd-project-template/
├── .env.example
├── .gitignore
├── README.md
├── requirements.txt
├── package.json
├── tsconfig.json
├── tailwind.config.js
├── docs/
│   ├── specs/
│   ├── api/
│   └── guides/
├── src/
│   ├── components/
│   ├── utils/
│   ├── types/
│   └── tests/
├── scripts/
│   ├── setup.sh
│   ├── test.sh
│   └── deploy.sh
└── .trae/
    ├── config.json
    ├── templates/
    └── workflows/
```

### 3.7.2 Trae AI工作流配置

创建`.trae/config.json`：
```json
{
  "version": "1.0",
  "project": {
    "name": "SDD Project",
    "type": "full-stack",
    "languages": ["python", "typescript"],
    "frameworks": ["fastapi", "react", "tailwindcss"]
  },
  "sdd": {
    "enabled": true,
    "specDir": "docs/specs",
    "templateDir": ".trae/templates",
    "autoGenerate": {
      "tests": true,
      "docs": true,
      "types": true
    }
  },
  "ai": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "features": {
      "codeCompletion": true,
      "codeReview": true,
      "testGeneration": true,
      "docGeneration": true
    }
  },
  "quality": {
    "linting": {
      "python": ["black", "flake8", "mypy"],
      "typescript": ["eslint", "prettier"]
    },
    "testing": {
      "python": "pytest",
      "typescript": "jest"
    }
  }
}
```

### 3.7.3 预提交钩子配置

创建`.pre-commit-config.yaml`：
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 22.10.0
    hooks:
      - id: black
        language_version: python3

  - repo: https://github.com/pycqa/flake8
    rev: 5.0.4
    hooks:
      - id: flake8

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v0.991
    hooks:
      - id: mypy
        additional_dependencies: [types-requests]

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.0.0-alpha.4
    hooks:
      - id: prettier
        types_or: [css, scss, javascript, ts, tsx, json, yaml]
```

安装预提交钩子：
```bash
pre-commit install
```

## 3.8 环境验证

### 3.8.1 创建验证脚本

创建`scripts/verify-setup.py`：
```python
#!/usr/bin/env python3
"""
环境配置验证脚本
"""

import sys
import subprocess
import importlib
from pathlib import Path

def check_python_version():
    """检查Python版本"""
    version = sys.version_info
    if version.major == 3 and version.minor >= 8:
        print(f"✅ Python {version.major}.{version.minor}.{version.micro}")
        return True
    else:
        print(f"❌ Python版本过低: {version.major}.{version.minor}.{version.micro}")
        return False

def check_package(package_name):
    """检查Python包是否安装"""
    try:
        importlib.import_module(package_name)
        print(f"✅ {package_name}")
        return True
    except ImportError:
        print(f"❌ {package_name} 未安装")
        return False

def check_command(command):
    """检查命令行工具是否可用"""
    try:
        result = subprocess.run([command, '--version'], 
                              capture_output=True, text=True)
        if result.returncode == 0:
            print(f"✅ {command}")
            return True
        else:
            print(f"❌ {command} 不可用")
            return False
    except FileNotFoundError:
        print(f"❌ {command} 未找到")
        return False

def check_env_file():
    """检查环境变量文件"""
    env_file = Path('.env')
    if env_file.exists():
        print("✅ .env 文件存在")
        return True
    else:
        print("❌ .env 文件不存在")
        return False

def main():
    print("🔍 开始环境验证...\n")
    
    checks = [
        ("Python版本", check_python_version),
        ("requests", lambda: check_package('requests')),
        ("click", lambda: check_package('click')),
        ("pytest", lambda: check_package('pytest')),
        ("black", lambda: check_package('black')),
        ("Node.js", lambda: check_command('node')),
        ("npm", lambda: check_command('npm')),
        ("TypeScript", lambda: check_command('tsc')),
        ("Git", lambda: check_command('git')),
        ("环境变量", check_env_file),
    ]
    
    passed = 0
    total = len(checks)
    
    for name, check_func in checks:
        if check_func():
            passed += 1
    
    print(f"\n📊 验证结果: {passed}/{total} 项通过")
    
    if passed == total:
        print("🎉 环境配置完成！可以开始SDD开发了。")
        return 0
    else:
        print("⚠️  请修复上述问题后重新验证。")
        return 1

if __name__ == '__main__':
    sys.exit(main())
```

### 3.8.2 运行验证

```bash
# 给脚本执行权限
chmod +x scripts/verify-setup.py

# 运行验证
python scripts/verify-setup.py
```

## 3.9 故障排除

### 3.9.1 常见问题

**问题1：Python版本冲突**
```bash
# 解决方案：使用pyenv管理版本
pyenv versions
pyenv global 3.8.18
```

**问题2：npm权限问题**
```bash
# 解决方案：配置npm全局目录
npm config set prefix ~/.npm-global
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

**问题3：API密钥无效**
```bash
# 检查环境变量
echo $DEEPSEEK_API_KEY

# 重新加载环境变量
source .env
```

### 3.9.2 性能优化

**IDE性能优化：**
```json
{
  "performance": {
    "indexing": {
      "excludePatterns": ["node_modules", "*.pyc", "__pycache__"],
      "maxFileSize": "10MB"
    },
    "memory": {
      "heapSize": "4GB",
      "gcInterval": "30s"
    }
  }
}
```

## 小结

本章我们完成了SDD开发环境的完整搭建：

1. **Trae AI IDE**：安装并配置了专业的AI辅助开发环境
2. **Python环境**：搭建了Python 3.8+开发环境和虚拟环境
3. **TypeScript环境**：配置了Node.js和TypeScript开发工具链
4. **Tailwind CSS**：集成了现代化的CSS框架
5. **API配置**：设置了DeepSeek等AI服务的API密钥
6. **开发工具**：安装了必备的开发和调试工具
7. **SDD工作流**：配置了专门的SDD开发流程和模板

环境搭建完成后，你已经具备了进行SDD实践的所有基础条件。在下一章中，我们将通过第一个实际案例来体验SDD的完整开发流程。

**检查清单：**
- [ ] Trae AI IDE安装并正常启动
- [ ] Python 3.8+环境可用
- [ ] Node.js和TypeScript环境配置完成
- [ ] Tailwind CSS集成成功
- [ ] API密钥配置并测试通过
- [ ] 开发工具安装完成
- [ ] 环境验证脚本运行通过

完成以上检查后，你就可以开始激动人心的SDD实践之旅了！